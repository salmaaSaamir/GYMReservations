<div *ngIf="isSpinner">
  <app-loader></app-loader>
</div>

<div *ngIf="!isSpinner">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Members</h3>
    <button class="btn btn-primary d-flex align-items-center gap-1" (click)="openAddMember()">
      <i class="bi bi-plus-lg"></i> Add Member
    </button>
  </div>

  <!-- Search Input -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group d-flex align-items-center">
        <span class="input-group-text">
          <i class="bi bi-search"></i>
        </span>
        <input type="text" class="form-control" placeholder="Search members..." 
               [(ngModel)]="searchTerm" (input)="onSearch()">
      
      </div>
    </div>
  
  </div>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>ID Card</th>
          <!-- <th>Status</th> -->
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of filteredMembers">
          <td>{{ u.Id }}</td>
          <td>{{ u.Name }}</td>
          <td>{{ u.Phone }}</td>
          <td>{{ u.Email }}</td>
          <td>{{ u.IDCard }}</td>
          <!-- <td>
            <span class="badge bg-success" *ngIf="hasActiveSubscription(u.Id)">Active</span>
            <span class="badge bg-secondary" *ngIf="!hasActiveSubscription(u.Id)">Inactive</span>
          </td> -->
          <td class="text-end">
            <div class="btn-group" role="group">
              <!-- Freeze Button - Only show if member has active subscription -->
              <button class="btn btn-sm btn-outline-warning iconButton" 
                      matTooltip="Freeze Subscription" 
                      (click)="freezeMember(u)"
                      *ngIf="hasActiveSubscription(u.Id)">
                <i class="bi bi-snow"></i>
              </button>
              
              <!-- Subscription History Button -->
              <button class="btn btn-sm btn-outline-info iconButton" 
                      matTooltip="Subscription History" 
                      (click)="viewSubscriptionHistory(u)">
                <i class="bi bi-clock-history"></i>
              </button>
              
              <!-- Edit Button -->
              <button class="btn btn-sm btn-outline-secondary iconButton" 
                      matTooltip="Edit" 
                      (click)="openAddMember(u)">
                <i class="bi bi-pencil"></i>
              </button>
              
              <!-- Delete Button -->
              <button class="btn btn-sm btn-outline-danger iconButton" 
                      matTooltip="Delete" 
                      (click)="deleteMember(u.Id)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredMembers.length === 0">
          <td colspan="7" class="text-center">
            {{ searchTerm ? 'No members found matching your search' : 'No Members found' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Page size selector -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
      <label for="pageSize" class="me-2">Items per page:</label>
      <select id="pageSize" class="form-select form-select-sm" style="width: 80px;" 
              [(ngModel)]="pageSize" (change)="onPageSizeChange()">
        <option *ngFor="let size of pageSizeOptions" [value]="size">{{size}}</option>
      </select>
    </div>
    <div class="text-muted">
      {{ (currentPage - 1) * pageSize + 1 }} to {{ getShowingTo() }} of {{ totalCount }} Members
    </div>
  </div>
</div>

<!-- Add/Edit Member Form -->
<app-add-member *ngIf="isAddMember" [member]="selectedMember" [lastIDCard]="LastIDCard"
  (closeAddMemberModal)="closeAddMemberModal()">
</app-add-member>

<app-list-subscriptions-history *ngIf="IsviewSubscriptionHistory" [member]="HistoryMember"
  (closeMemberHistoryModal)="CloseviewSubscriptionHistory()">
</app-list-subscriptions-history>